    <script>
        // --- 1. الإعدادات الأساسية ---
        const urlParams = new URLSearchParams(window.location.search);
        // نتأكد أن الرقم يتم قراءته بشكل صحيح
        let currentId = parseInt(urlParams.get('id'));
        if (isNaN(currentId) || currentId < 1) currentId = 78; // افتراضي: النبأ
        
        // جلب الاسم من الرابط أو من القائمة الداخلية
        let currentName = urlParams.get('name');

        const audioPlayer = document.getElementById('audioPlayer');
        const quranText = document.getElementById('quranText');
        const surahNameTitle = document.getElementById('surahNameTitle');
        const btnPlay = document.getElementById('btnPlay');
        let isPlaying = false;

        // --- 2. بيانات أسماء السور (للتنقل) ---
        const surahNames = {
            78: "النبأ", 79: "النازعات", 80: "عبس", 81: "التكوير",
            82: "الانفطار", 83: "المطففين", 84: "الانشقاق", 85: "البروج", 86: "الطارق",
            87: "الأعلى", 88: "الغاشية", 89: "الفجر", 90: "البلد", 91: "الشمس",
            92: "الليل", 93: "الضحى", 94: "الشرح", 95: "التين", 96: "العلق",
            97: "القدر", 98: "البينة", 99: "الزلزلة", 100: "العاديات", 101: "القارعة",
            102: "التكاثر", 103: "العصر", 104: "الهمزة", 105: "الفيل", 106: "قريش",
            107: "الماعون", 108: "الكوثر", 109: "الكافرون", 110: "النصر", 111: "المسد",
            112: "الإخلاص", 113: "الفلق", 114: "الناس"
        };

        // إذا لم يكن الاسم موجوداً في الرابط، نجلبه من القائمة
        if (!currentName && surahNames[currentId]) {
            currentName = surahNames[currentId];
        }

        // --- 3. بيانات النص القرآني (الجزء 30 كاملاً) ---
        // (تأكد أنك نسخت كائن quranData الكبير الذي أرسلته لك سابقاً ووضعه هنا)
        // سأضع لك مثالاً صغيراً، ويجب أن تضع القائمة الكاملة التي عندك
        const quranData = {
             // ... ضع هنا قائمة النصوص الطويلة التي كانت في الكود السابق ...
             // للتجربة، سأضع السور المطلوبة لتعمل الآن، لكن عليك إبقاء القائمة الكبيرة عندك
             88: `بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ
هَلۡ أَتَىٰكَ حَدِيثُ ٱلۡغَٰشِيَةِ (1) وُجُوهٞ يَوۡمَئِذٍ خَٰشِعَةٌ (2) عَامِلَةٞ نَّاصِبَةٞ (3) تَصۡلَىٰ نَارًا حَامِيَةٗ (4) تُسۡقَىٰ مِنۡ عَيۡنٍ ءَانِيَةٖ (5) لَّيۡسَ لَهُمۡ طَعَامٌ إِلَّا مِن ضَرِيعٖ (6) لَّا يُسۡمِنُ وَلَا يُغۡنِي مِن جُوعٖ (7) وُجُوهٞ يَوۡمَئِذٖ نَّاعِمَةٞ (8) لِّسَعۡيِهَا رَاضِيَةٞ (9) فِي جَنَّةٍ عَالِيَةٖ (10) لَّا تَسۡمَعُ فِيهَا لَٰغِيَةٗ (11) فِيهَا عَيۡنٞ جَارِيَةٞ (12) فِيهَا سُرُرٞ مَّرۡفُوعَةٞ (13) وَأَكۡوَابٞ مَّوۡضُوعَةٞ (14) وَنَمَارِقُ مَصۡفُوفَةٞ (15) وَزَرَابِيُّ مَبۡثُوثَةٌ (16) أَفَلَا يَنظُرُونَ إِلَى ٱلۡإِبِلِ كَيۡفَ خُلِقَتۡ (17) وَإِلَى ٱلسَّمَآءِ كَيۡفَ رُفِعَتۡ (18) وَإِلَى ٱلۡجِبَالِ كَيۡفَ نُصِبَتۡ (19) وَإِلَى ٱلۡأَرۡضِ كَيۡفَ سُطِحَتۡ (20) فَذَكِّرۡ إِنَّمَآ أَنتَ مُذَكِّرٞ (21) لَّسۡتَ عَلَيۡهِم بِمُصَيۡطِرٍ (22) إِلَّا مَن تَوَلَّىٰ وَكَفَرَ (23) فَيُعَذِّبُهُ ٱللَّهُ ٱلۡعَذَابَ ٱلۡأَكۡبَرَ (24) إِنَّ إِلَيۡنَآ إِيَابَهُمۡ (25) ثُمَّ إِنَّ عَلَيۡنَا حِسَابَهُم (26)`
             // ... وهكذا لباقي السور ...
        };
        // ملاحظة: تأكد أن كود quranData موجود في ملفك كاملاً كما أرسلته لك سابقاً.

        // --- 4. دالة تنسيق النص ---
        function formatQuranText(text) {
            if(!text) return "جاري إضافة النص...";
            let formatted = text.replace('بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ', '<span class="basmala">بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ</span>');
            formatted = formatted.replace(/\((\d+)\)/g, '<span class="ayah-num">﴿$1﴾</span>');
            formatted = formatted.replace(/\n/g, '<br>');
            return formatted;
        }

        // --- 5. التشغيل والتحميل (هنا التعديل الجذري) ---
        function loadSurah(id, name) {
            surahNameTitle.innerText = "سورة " + name;

            // 1. تحويل رقم السورة إلى صيغة 3 أرقام (مثلاً 88 تصبح 088)
            const formattedId = id.toString().padStart(3, '0');
            
            // 2. الرابط المباشر والقوي (المنشاوي المعلم)
            const audioUrl = `https://server10.mp3quran.net/minsh_awi/${formattedId}.mp3`;
            
            console.log("Loading Audio:", audioUrl); // للمبرمج ليتأكد من الرابط
            
            audioPlayer.src = audioUrl;
            audioPlayer.load();

            // عرض النص
            // (نستخدم بياناتك المخزنة، وإذا لم توجد نظهر رسالة)
            // في الكود السابق لديك القائمة كاملة، تأكد من وجودها
            const textData = typeof quranData !== 'undefined' ? quranData[id] : null;
            
            if (textData) {
                quranText.innerHTML = formatQuranText(textData);
            } else {
                // محاولة جلب النص في حال لم يكن مخزناً (احتياطي)
                quranText.innerHTML = "اضغط تشغيل للاستماع...";
            }
        }

        function togglePlay() {
            if (audioPlayer.paused) {
                const playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        btnPlay.innerText = "⏸";
                        isPlaying = true;
                    }).catch(error => {
                        console.error("Playback Error:", error);
                        alert("اضغط مرة أخرى، المتصفح يحتاج تأكيدك للتشغيل.");
                    });
                }
            } else {
                audioPlayer.pause();
                btnPlay.innerText = "▶";
                isPlaying = false;
            }
        }

        audioPlayer.onended = () => {
            btnPlay.innerText = "▶";
            isPlaying = false;
        };

        // --- 6. التنقل ---
        function nextSurah() {
            let nextId = currentId + 1;
            if (nextId > 114) nextId = 78;
            updateSurah(nextId);
        }

        function prevSurah() {
            let prevId = currentId - 1;
            if (prevId < 78) prevId = 114;
            updateSurah(prevId);
        }

        function updateSurah(newId) {
            currentId = newId;
            let name = surahNames[newId] || "سورة";
            
            const newUrl = `surah.html?id=${newId}&name=${encodeURIComponent(name)}`;
            window.history.pushState({path: newUrl}, '', newUrl);

            audioPlayer.pause();
            btnPlay.innerText = "▶";
            loadSurah(currentId, name);
        }

        // --- 7. عند بدء الصفحة ---
        window.onload = () => {
            loadSurah(currentId, currentName);
            btnPlay.focus();
        };

        // زر الرجوع
        document.addEventListener('keydown', function(e) {
            if(e.key === 'Backspace' || e.key === 'Escape') {
                window.location.href = 'surah_list.html';
            }
        });

    </script>
