<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المصحف المعلم - دينا</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            /* الخلفية التركوازية مثل الصورة المرفقة */
            background: #26a69a; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            font-family: 'Cairo', sans-serif;
            overflow: hidden;
            direction: rtl;
        }

        .top-bar {
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
        }

        .top-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid #fff;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: #fff;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
        }

        /* اللوحة الكريمي */
        .paper-board {
            margin-top: 15vh;
            width: 90%;
            max-width: 600px;
            height: 45vh;
            background: #fff9c4; /* لون كريمي أصفر فاتح */
            border-radius: 25px;
            border: 6px solid #e0e0e0; /* إطار رمادي/أبيض */
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            z-index: 10;
        }

        /* عنوان السورة (اللافتة الصفراء) */
        .title-sign {
            background: #fdd835;
            color: #3e2723;
            padding: 8px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            position: absolute;
            top: -25px;
            border: 3px solid #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .quran-text-area {
            width: 100%;
            height: 100%;
            margin-top: 20px;
            text-align: center;
            font-family: 'Amiri', serif;
            font-size: 28px;
            color: #000;
            line-height: 2.2;
            overflow-y: auto;
            padding: 10px;
        }
        .quran-text-area::-webkit-scrollbar { display: none; }

        .basmala {
            display: block;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .ayah-num {
            color: #d32f2f;
            font-size: 0.8em;
            margin: 0 5px;
            background: rgba(255, 213, 79, 0.4);
            padding: 0 5px;
            border-radius: 50%;
        }

        /* أزرار التحكم البرتقالية */
        .controls-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: -30px; /* تداخل مع اللوحة */
            z-index: 20;
            position: relative;
        }

        .ctrl-btn {
            background: #ffb74d; /* برتقالي فاتح */
            border: 4px solid #fff;
            border-radius: 50%;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }

        .ctrl-btn:active { transform: scale(0.95); }

        .btn-play {
            width: 90px;
            height: 90px;
            font-size: 40px;
            background: #ff9800; /* برتقالي أغمق للتشغيل */
        }
        
        .btn-nav {
            width: 60px;
            height: 60px;
            font-size: 24px;
        }

        /* صورة الشخصية */
        .character-img {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            max-width: 80%;
            z-index: 5;
            pointer-events: none;
        }

    </style>
</head>
<body>

    <div class="top-bar">
        <button class="top-btn" onclick="location.reload()">↻</button>
        <a href="surah_list.html" class="top-btn">➜</a>
    </div>

    <div class="paper-board">
        <div class="title-sign" id="surahNameTitle">...</div>
        <div class="quran-text-area" id="quranText"></div>
    </div>

    <div class="controls-container">
        <button class="ctrl-btn btn-nav" onclick="nextSurah()">⏮</button>
        <button class="ctrl-btn btn-play" onclick="togglePlay()" id="btnPlay">▶</button>
        <button class="ctrl-btn btn-nav" onclick="prevSurah()">⏭</button>
    </div>

    <img src="assets/images/girl.png" alt="Character" class="character-img">

    <audio id="audioPlayer" preload="auto"></audio>

    <script>
        // --- 1. روابط الصوت (القائمة التي طلبتها بالضبط) ---
        const audioSources = {
            78: "https://surahquran.com/mp3/Minshawi-with-kids/78.mp3",
            79: "https://surahquran.com/mp3/Minshawi-with-kids/79.mp3",
            80: "https://surahquran.com/mp3/Minshawi-with-kids/80.mp3",
            81: "https://surahquran.com/mp3/Minshawi-with-kids/81.mp3",
            82: "https://surahquran.com/mp3/Minshawi-with-kids/82.mp3",
            83: "https://surahquran.com/mp3/Minshawi-with-kids/83.mp3",
            84: "https://surahquran.com/mp3/Minshawi-with-kids/84.mp3",
            85: "https://surahquran.com/mp3/Minshawi-with-kids/85.mp3",
            86: "https://surahquran.com/mp3/Minshawi-with-kids/86.mp3",
            87: "https://surahquran.com/mp3/Minshawi-with-kids/87.mp3",
            88: "https://surahquran.com/mp3/Minshawi-with-kids/88.mp3",
            89: "https://surahquran.com/mp3/Minshawi-with-kids/89.mp3",
            90: "https://surahquran.com/mp3/Minshawi-with-kids/90.mp3",
            91: "https://surahquran.com/mp3/Minshawi-with-kids/91.mp3",
            92: "https://surahquran.com/mp3/Minshawi-with-kids/92.mp3",
            93: "https://surahquran.com/mp3/Minshawi-with-kids/93.mp3",
            94: "https://surahquran.com/mp3/Minshawi-with-kids/94.mp3",
            95: "https://surahquran.com/mp3/Minshawi-with-kids/95.mp3",
            96: "https://surahquran.com/mp3/Minshawi-with-kids/96.mp3",
            97: "https://surahquran.com/mp3/Minshawi-with-kids/97.mp3",
            98: "https://surahquran.com/mp3/Minshawi-with-kids/98.mp3",
            99: "https://surahquran.com/mp3/Minshawi-with-kids/99.mp3",
            100: "https://surahquran.com/mp3/Minshawi-with-kids/100.mp3",
            101: "https://surahquran.com/mp3/Minshawi-with-kids/101.mp3",
            102: "https://surahquran.com/mp3/Minshawi-with-kids/102.mp3",
            103: "https://surahquran.com/mp3/Minshawi-with-kids/103.mp3",
            104: "https://surahquran.com/mp3/Minshawi-with-kids/104.mp3",
            105: "https://surahquran.com/mp3/Minshawi-with-kids/105.mp3",
            106: "https://surahquran.com/mp3/Minshawi-with-kids/106.mp3",
            107: "https://surahquran.com/mp3/Minshawi-with-kids/107.mp3",
            108: "https://surahquran.com/mp3/Minshawi-with-kids/108.mp3",
            109: "https://surahquran.com/mp3/Minshawi-with-kids/109.mp3",
            110: "https://surahquran.com/mp3/Minshawi-with-kids/110.mp3",
            111: "https://surahquran.com/mp3/Minshawi-with-kids/111.mp3",
            112: "https://surahquran.com/mp3/Minshawi-with-kids/112.mp3",
            113: "https://surahquran.com/mp3/Minshawi-with-kids/113.mp3",
            114: "https://surahquran.com/mp3/Minshawi-with-kids/114.mp3"
        };

        const surahNames = {
            78: "النبأ", 79: "النازعات", 80: "عبس", 81: "التكوير", 82: "الانفطار", 83: "المطففين", 84: "الانشقاق", 85: "البروج", 86: "الطارق", 87: "الأعلى", 88: "الغاشية", 89: "الفجر", 90: "البلد", 91: "الشمس", 92: "الليل", 93: "الضحى", 94: "الشرح", 95: "التين", 96: "العلق", 97: "القدر", 98: "البينة", 99: "الزلزلة", 100: "العاديات", 101: "القارعة", 102: "التكاثر", 103: "العصر", 104: "الهمزة", 105: "الفيل", 106: "قريش", 107: "الماعون", 108: "الكوثر", 109: "الكافرون", 110: "النصر", 111: "المسد", 112: "الإخلاص", 113: "الفلق", 114: "الناس"
        };

        // --- 2. بيانات النص (جزء من البيانات للحجم، يفضل وضع كامل النص هنا) ---
        // ملاحظة: تأكد من نسخ كود النصوص quranData كاملاً كما في المرات السابقة هنا
        // سأضع كود الاستدعاء ليعمل الكود بشكل صحيح
        const quranData = {
            78: `بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ\nعَمَّ يَتَسَآءَلُونَ (1) عَنِ ٱلنَّبَإِ ٱلۡعَظِيمِ (2) ... (يرجى نسخ النص الكامل هنا) ...`,
            // ... (ضع باقي النصوص هنا كما كانت في الكود السابق) ...
            80: `بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ\nعَبَسَ وَتَوَلَّىٰٓ (1) أَن جَآءَهُ ٱلۡأَعۡمَىٰ (2) ...`
        };

        // --- تهيئة الصفحة ---
        const urlParams = new URLSearchParams(window.location.search);
        let currentId = parseInt(urlParams.get('id')) || 78; 
        
        const audioPlayer = document.getElementById('audioPlayer');
        const quranText = document.getElementById('quranText');
        const surahNameTitle = document.getElementById('surahNameTitle');
        const btnPlay = document.getElementById('btnPlay');
        let isPlaying = false;

        function formatText(text) {
            if (!text) return "جاري تحميل النص...";
            let formatted = text.replace('بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ', '<span class="basmala">بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ</span>');
            formatted = formatted.replace(/\((\d+)\)/g, '<span class="ayah-num">﴿$1﴾</span>');
            formatted = formatted.replace(/\n/g, '<br>');
            return formatted;
        }

        function loadSurah(id) {
            const name = surahNames[id];
            surahNameTitle.innerText = "سورة " + name;

            // تحديث الرابط في المتصفح
            const newUrl = `surah.html?id=${id}&name=${encodeURIComponent(name)}`;
            window.history.pushState({path: newUrl}, '', newUrl);

            // 1. تحميل النص
            // (استخدم المتغير quranData الكامل الذي لديك)
            // سأقوم بجلب النص بشكل افتراضي إذا لم يكن موجوداً للتجربة
            if (quranData[id]) {
                quranText.innerHTML = formatText(quranData[id]);
            } else {
                 // في حال نسيت نسخ كائن النصوص، سنعرض رسالة
                quranText.innerHTML = formatText(`بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ\nسورة ${name} جاهزة للاستماع`);
            }

            // 2. تحميل الصوت (الخطوة الأهم)
            const audioUrl = audioSources[id];
            if (audioUrl) {
                audioPlayer.src = audioUrl;
                audioPlayer.load();
                console.log("تم تحميل الرابط:", audioUrl);
            } else {
                alert("لا يوجد رابط صوتي لهذه السورة");
            }
        }

        function togglePlay() {
            if (audioPlayer.paused) {
                const playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        btnPlay.innerText = "⏸";
                        isPlaying = true;
                    }).catch(error => {
                        console.error(error);
                        // هذا التنبيه سيظهر لو كان هناك مشكلة حقيقية في الرابط
                        alert("عذراً، الرابط الصوتي لا يعمل أو تم حظره من المصدر. حاول مرة أخرى.");
                    });
                }
            } else {
                audioPlayer.pause();
                btnPlay.innerText = "▶";
                isPlaying = false;
            }
        }

        // عند انتهاء السورة
        audioPlayer.onended = () => {
            btnPlay.innerText = "▶";
            isPlaying = false;
        };
        
        // عند حدوث خطأ في تحميل الملف
        audioPlayer.onerror = () => {
             alert("حدث خطأ في تحميل ملف الصوت من المصدر surahquran.com");
        };

        function nextSurah() {
            let next = currentId + 1;
            if (next > 114) next = 78;
            currentId = next;
            stopAndLoad();
        }

        function prevSurah() {
            let prev = currentId - 1;
            if (prev < 78) prev = 114;
            currentId = prev;
            stopAndLoad();
        }

        function stopAndLoad() {
            audioPlayer.pause();
            btnPlay.innerText = "▶";
            loadSurah(currentId);
        }

        // التشغيل عند الفتح
        window.onload = () => {
            loadSurah(currentId);
        };

    </script>
</body>
</html>
