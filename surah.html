<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…Ø¹Ù„Ù… - Ø¯ÙŠÙ†Ø§</title>
    <style>
        /* --- Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª --- */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: #222;
        }

        /* Ø§Ù„Ø®Ù„ÙÙŠØ© */
        .bg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('assets/bg-main.png') no-repeat center center;
            background-size: cover;
            z-index: 1;
        }

        /* --- Ø§Ù„Ø´Ø§Ø´Ø© 1: Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --- */
        #menuSection {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.7);
            transition: top 0.5s ease;
        }

        .menu-title {
            color: #FFD54F; font-size: 2.5rem; font-weight: bold; margin-bottom: 30px;
            text-shadow: 0 2px 5px black;
        }

        .surah-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
            width: 90%; max-width: 600px;
        }

        .surah-btn {
            background: white; border: none; border-bottom: 5px solid #00897B;
            border-radius: 15px; padding: 15px;
            font-size: 1.5rem; font-weight: bold; color: #00695C;
            cursor: pointer; transition: 0.2s;
        }

        .surah-btn:active {
            transform: translateY(4px); border-bottom: 0;
        }

        /* --- Ø§Ù„Ø´Ø§Ø´Ø© 2: Ø§Ù„Ù…Ø´ØºÙ„ --- */
        #playerSection {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; display: none; /* Ù…Ø®ÙÙŠ */
        }

        .top-bar {
            position: absolute; top: 0; width: 100%; padding: 20px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 50;
        }

        .back-btn {
            background: #FF5722; color: white; border: 2px solid white;
            padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer;
        }

        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ */
        .quran-text-box {
            position: absolute; top: 15%; left: 50%; transform: translateX(-50%);
            width: 85%; max-height: 25%; overflow-y: auto;
            background: rgba(255, 255, 255, 0.95);
            border: 4px solid #FFCA28; border-radius: 20px;
            padding: 15px; text-align: center;
            font-size: 1.8rem; font-weight: bold; color: #333;
            line-height: 1.8; z-index: 40;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Ø§Ù„Ø´Ø®ØµÙŠØ© */
        .character-zone {
            position: absolute; bottom: 0; width: 100%; height: 60%;
            display: flex; justify-content: center; align-items: flex-end;
            pointer-events: none; z-index: 30;
        }
        
        .dina-wrapper { position: relative; height: 100%; }
        #dinaImg { height: 100%; display: block; }

        #mouth {
            position: absolute;
            top: 56%; left: 41.5%; transform: translate(-50%, -50%);
            width: 19%;
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #loading {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: white; padding: 20px;
            border-radius: 10px; display: none; z-index: 100;
        }

    </style>
</head>
<body>

    <div class="bg-layer"></div>
    <div id="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ø§ÙˆØ©...</div>

    <div id="menuSection">
        <div class="menu-title">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø³ÙˆØ±Ø© ÙŠØ§ Ø¯ÙŠÙ†Ø§</div>
        <div class="surah-grid">
            <button class="surah-btn" onclick="playSurah('001', 'Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©')">Ø§Ù„ÙØ§ØªØ­Ø©</button>
            <button class="surah-btn" onclick="playSurah('112', 'Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ø®Ù„Ø§Øµ')">Ø§Ù„Ø¥Ø®Ù„Ø§Øµ</button>
            <button class="surah-btn" onclick="playSurah('113', 'Ø³ÙˆØ±Ø© Ø§Ù„ÙÙ„Ù‚')">Ø§Ù„ÙÙ„Ù‚</button>
            <button class="surah-btn" onclick="playSurah('114', 'Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ø§Ø³')">Ø§Ù„Ù†Ø§Ø³</button>
            <button class="surah-btn" onclick="playSurah('108', 'Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙˆØ«Ø±')">Ø§Ù„ÙƒÙˆØ«Ø±</button>
            <button class="surah-btn" onclick="playSurah('110', 'Ø³ÙˆØ±Ø© Ø§Ù„Ù†ØµØ±')">Ø§Ù„Ù†ØµØ±</button>
        </div>
    </div>

    <div id="playerSection">
        <div class="top-bar">
            <button class="back-btn" onclick="stopAndBack()">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ </button>
        </div>

        <div class="quran-text-box" id="quranText">
            Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…
        </div>

        <div class="character-zone">
            <div class="dina-wrapper">
                <img src="assets/images/girl.png" id="dinaImg">
                <img src="assets/images/mouth_closed.png" id="mouth">
            </div>
        </div>
    </div>

    <audio id="audioPlayer" crossorigin="anonymous"></audio>

<script>
    // --- Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØµÙˆØµ (Ù„Ù„Ø³ÙˆØ± Ø§Ù„Ù‚ØµÙŠØ±Ø©) ---
    const surahTexts = {
        '001': "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù (1) Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù (2) Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù (3) Ù…ÙØ§Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù (4) Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ¹Ù’Ø¨ÙØ¯Ù ÙˆÙØ¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠÙ†Ù (5) Ø§Ù‡Ù’Ø¯ÙÙ†ÙØ§ Ø§Ù„ØµÙÙ‘Ø±ÙØ§Ø·Ù Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚ÙÙŠÙ…Ù (6) ØµÙØ±ÙØ§Ø·Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙÙ†Ù’Ø¹ÙÙ…Ù’ØªÙ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ØºÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ø§Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù (7)",
        '112': "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù. Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ­ÙØ¯ÙŒ (1) Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„ØµÙÙ‘Ù…ÙØ¯Ù (2) Ù„ÙÙ…Ù’ ÙŠÙÙ„ÙØ¯Ù’ ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙˆÙ„ÙØ¯Ù’ (3) ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙƒÙÙ†Ù’ Ù„ÙÙ‡Ù ÙƒÙÙÙÙˆÙ‹Ø§ Ø£ÙØ­ÙØ¯ÙŒ (4)",
        '113': "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù. Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù’ÙÙÙ„ÙÙ‚Ù (1) Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ Ø®ÙÙ„ÙÙ‚Ù (2) ÙˆÙÙ…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ ØºÙØ§Ø³ÙÙ‚Ù Ø¥ÙØ°ÙØ§ ÙˆÙÙ‚ÙØ¨Ù (3) ÙˆÙÙ…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ø§Ù„Ù†ÙÙ‘ÙÙÙ‘Ø§Ø«ÙØ§ØªÙ ÙÙÙŠ Ø§Ù„Ù’Ø¹ÙÙ‚ÙØ¯Ù (4) ÙˆÙÙ…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ø­ÙØ§Ø³ÙØ¯Ù Ø¥ÙØ°ÙØ§ Ø­ÙØ³ÙØ¯Ù (5)",
        '114': "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù. Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù (1) Ù…ÙÙ„ÙÙƒÙ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù (2) Ø¥ÙÙ„ÙÙ‡Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù (3) Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ø§Ù„Ù’ÙˆÙØ³Ù’ÙˆÙØ§Ø³Ù Ø§Ù„Ù’Ø®ÙÙ†ÙÙ‘Ø§Ø³Ù (4) Ø§Ù„ÙÙ‘Ø°ÙÙŠ ÙŠÙÙˆÙØ³Ù’ÙˆÙØ³Ù ÙÙÙŠ ØµÙØ¯ÙÙˆØ±Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù (5) Ù…ÙÙ†Ù Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù ÙˆÙØ§Ù„Ù†ÙÙ‘Ø§Ø³Ù (6)",
        '108': "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù. Ø¥ÙÙ†ÙÙ‘Ø§ Ø£ÙØ¹Ù’Ø·ÙÙŠÙ’Ù†ÙØ§ÙƒÙ Ø§Ù„Ù’ÙƒÙÙˆÙ’Ø«ÙØ±Ù (1) ÙÙØµÙÙ„ÙÙ‘ Ù„ÙØ±ÙØ¨ÙÙ‘ÙƒÙ ÙˆÙØ§Ù†Ù’Ø­ÙØ±Ù’ (2) Ø¥ÙÙ†ÙÙ‘ Ø´ÙØ§Ù†ÙØ¦ÙÙƒÙ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø£ÙØ¨Ù’ØªÙØ±Ù (3)",
        '110': "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù. Ø¥ÙØ°ÙØ§ Ø¬ÙØ§Ø¡Ù Ù†ÙØµÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ§Ù„Ù’ÙÙØªÙ’Ø­Ù (1) ÙˆÙØ±ÙØ£ÙÙŠÙ’ØªÙ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù ÙŠÙØ¯Ù’Ø®ÙÙ„ÙÙˆÙ†Ù ÙÙÙŠ Ø¯ÙÙŠÙ†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙÙ’ÙˆÙØ§Ø¬Ù‹Ø§ (2) ÙÙØ³ÙØ¨ÙÙ‘Ø­Ù’ Ø¨ÙØ­ÙÙ…Ù’Ø¯Ù Ø±ÙØ¨ÙÙ‘ÙƒÙ ÙˆÙØ§Ø³Ù’ØªÙØºÙ’ÙÙØ±Ù’Ù‡Ù Ø¥ÙÙ†ÙÙ‘Ù‡Ù ÙƒÙØ§Ù†Ù ØªÙÙˆÙÙ‘Ø§Ø¨Ù‹Ø§ (3)"
    };

    const audio = document.getElementById('audioPlayer');
    const mouthImg = document.getElementById('mouth');
    const textBox = document.getElementById('quranText');
    const loadingDiv = document.getElementById('loading');
    
    let audioCtx, analyser, dataArray;
    let isContextSetup = false;

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    function playSurah(id, name) {
        // 1. Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        loadingDiv.style.display = 'block';

        // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ ÙÙˆØ±Ø§Ù‹
        textBox.innerText = surahTexts[id] || name; // ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ±Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ù†Øµ

        // 3. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±Ø§Ø¨Ø·
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· HTTPS Ø¢Ù…Ù† Ù…Ù† mp3quran
        audio.src = `https://server10.mp3quran.net/minsh/al_mus7af_al_mo3lim/${id}.mp3`;

        // 4. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙˆØª (Lip Sync Setup)
        if (!isContextSetup) {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
                analyser = audioCtx.createAnalyser();
                // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‚Ø¯ ÙŠÙØ´Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ø¨Ø³Ø¨Ø¨ CORS ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª
                // Ù„Ø°Ù„Ùƒ Ø£Ø¶ÙÙ†Ø§ try/catch ÙˆØ­Ù…Ø§ÙŠØ© ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
                const source = audioCtx.createMediaElementSource(audio);
                source.connect(analyser);
                analyser.connect(audioCtx.destination);
                analyser.fftSize = 256;
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                isContextSetup = true;
            } catch (e) {
                console.log("Audio API issue: ", e);
            }
        }
        
        // Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„ØµÙˆØªÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¹Ù„Ù‚Ø§Ù‹
        if (audioCtx && audioCtx.state === 'suspended') {
            audioCtx.resume();
        }

        // 5. Ø§Ù„ØªØ´ØºÙŠÙ„
        audio.play().then(() => {
            loadingDiv.style.display = 'none';
            document.getElementById('menuSection').style.display = 'none';
            document.getElementById('playerSection').style.display = 'block';
            requestAnimationFrame(animateMouth);
        }).catch(err => {
            loadingDiv.style.display = 'none';
            alert("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØªØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            console.error(err);
        });
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¬ÙˆØ¹
    function stopAndBack() {
        audio.pause();
        audio.currentTime = 0;
        document.getElementById('playerSection').style.display = 'none';
        document.getElementById('menuSection').style.display = 'flex';
        mouthImg.src = 'assets/images/mouth_closed.png';
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø±ÙƒØ©
    function animateMouth() {
        if (!audio.paused && !audio.ended) {
            requestAnimationFrame(animateMouth);

            if (analyser && dataArray) {
                analyser.getByteFrequencyData(dataArray);
                let sum = 0;
                for(let i=0; i<dataArray.length; i++) sum += dataArray[i];
                let vol = sum / dataArray.length;

                // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙÙ… Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª
                // Ø¥Ø°Ø§ ÙØ´Ù„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØª (Ø¨Ø³Ø¨Ø¨ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø³ÙŠØ±ÙØ±) Ø§Ù„ÙÙ… Ù„Ù† ÙŠØªØ­Ø±Ùƒ
                // Ù„Ø°Ø§ Ø³Ù†Ø¶Ø¹ Ø­Ø±ÙƒØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¨Ø³ÙŠØ·Ø© ÙƒØ¨Ø¯ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙˆØª ÙŠØ¹Ù…Ù„ ÙˆÙ„ÙƒÙ† Ø§Ù„ØªØ­Ù„ÙŠÙ„ ØµÙØ±
                if (vol > 0) {
                     // Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙŠØ¹Ù…Ù„
                    if (vol > 20) mouthImg.src = 'assets/images/mouth_open.png';
                    else if (vol > 10) mouthImg.src = 'assets/images/mouth_half.png';
                    else mouthImg.src = 'assets/images/mouth_closed.png';
                } else {
                    // Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ø­Ø¬ÙˆØ¨ (CORS) ÙˆÙ„ÙƒÙ† Ø§Ù„ØµÙˆØª ÙŠØ¹Ù…Ù„ -> Ø­Ø±ÙƒØ© "ÙˆÙ‡Ù…ÙŠØ©" Ø¨Ø³ÙŠØ·Ø©
                    // ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
                    let fakeSync = Date.now() % 300; 
                    if (fakeSync > 200) mouthImg.src = 'assets/images/mouth_open.png';
                    else mouthImg.src = 'assets/images/mouth_closed.png';
                }
            }
        } else {
            mouthImg.src = 'assets/images/mouth_closed.png';
        }
    }
</script>
</body>
</html>
