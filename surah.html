<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù†</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            /* Ø®Ù„ÙÙŠØ© Ø¬Ù…ÙŠÙ„Ø© ÙˆÙ‡Ø§Ø¯Ø¦Ø© */
            background: url('https://azooz152.github.io/deena-quran/assets/bg-main.png') center/cover fixed, linear-gradient(135deg, #81d4fa 0%, #b39ddb 100%); 
            background-blend-mode: overlay;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Tahoma', sans-serif;
        }

        .player-glass {
            width: 95%;
            height: 90vh;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 40px;
            border: 8px solid #ff7fa2;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        /* --- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠÙ…Ù†: Ø§Ù„Ø´Ø®ØµÙŠØ© --- */
        .character-section {
            width: 30%;
            background: #fff59d; /* Ø£ØµÙØ± Ø·ÙÙˆÙ„ÙŠ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-left: 5px solid #ff7fa2;
            position: relative;
        }

        .cartoon-char {
            width: 85%;
            position: relative;
        }
        
        .cartoon-char img {
            width: 100%;
            border-radius: 20px;
            border: 4px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Ø­Ø±ÙƒØ© Ø§Ù„ÙÙ… */
        .mouth-anim {
            position: absolute;
            top: 52%; /* Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ø­Ø³Ø¨ ØµÙˆØ±ØªÙƒ girl.png */
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 5px;
            background: #d32f2f;
            border-radius: 50%;
            transition: all 0.1s;
            opacity: 0.8;
            z-index: 10;
        }
        .talking {
            animation: talk 0.2s infinite alternate;
        }
        @keyframes talk {
            0% { height: 5px; width: 20px; border-radius: 50%; }
            100% { height: 15px; width: 25px; border-radius: 40%; border: 2px solid white; }
        }

        /* --- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠØ³Ø±: Ø§Ù„Ù†Øµ ÙˆØ§Ù„ØªØ­ÙƒÙ… --- */
        .content-section {
            width: 70%;
            padding: 20px 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }

        .surah-title {
            background: #7e57c2;
            color: #fff;
            padding: 10px 60px;
            border-radius: 30px;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ */
        .quran-text-box {
            background: #fff;
            width: 100%;
            flex-grow: 1;
            border-radius: 25px;
            border: 4px solid #b39ddb;
            padding: 25px;
            font-size: 32px; /* Ø®Ø· ÙƒØ¨ÙŠØ± */
            line-height: 2.2; /* ØªØ¨Ø§Ø¹Ø¯ Ù…Ø±ÙŠØ­ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© */
            color: #000;
            overflow-y: auto;
            text-align: justify; /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ */
            font-family: 'Amiri', 'Traditional Arabic', serif;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        /* ØªØ¬Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ§Øª */
        .ayah-symbol {
            color: #ff4081;
            font-size: 0.9em;
            margin: 0 5px;
            font-family: sans-serif;
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Øµ */
        .fade-in-text {
            animation: fadeIn 1s ease-in;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .controls {
            display: flex;
            gap: 40px;
            margin-top: 20px;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .btn-control {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: none;
            font-size: 35px;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, background 0.3s;
            color: #fff;
        }

        .btn-play { background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%); }
        .btn-pause { background: linear-gradient(135deg, #ef5350 0%, #e53935 100%); }
        .btn-back { background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%); }

        .btn-control:focus {
            transform: scale(1.25);
            border: 5px solid #fff;
            outline: none;
            box-shadow: 0 0 25px #ff4081;
        }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loader { font-size: 24px; color: #7e57c2; font-weight: bold; }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="player-glass">
        <div class="character-section">
            <div class="cartoon-char">
                <img src="assets/images/girl.png" alt="Ø¯ÙŠÙ†Ø§">
                <div class="mouth-anim" id="mouth"></div>
            </div>
        </div>

        <div class="content-section">
            <div class="surah-title" id="titleDisplay">...</div>
            
            <div class="quran-text-box" id="quranText">
                <div class="loader">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø³ÙˆØ±Ø©...</div>
            </div>

            <div class="controls">
                <button class="btn-control btn-play" id="playBtn" onclick="playAudio()">â–¶</button>
                <button class="btn-control btn-back" onclick="goBack()">ğŸ”™</button>
                <button class="btn-control btn-pause" id="pauseBtn" onclick="pauseAudio()">â¸</button>
            </div>
        </div>
    </div>

    <audio id="audioPlayer" preload="auto"></audio>

    <script>
        // 1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const urlParams = new URLSearchParams(window.location.search);
        const surahId = urlParams.get('id');
        const surahName = urlParams.get('name');

        // 2. Ø§Ù„Ø¹Ù†Ø§ØµØ±
        const audioPlayer = document.getElementById('audioPlayer');
        const quranText = document.getElementById('quranText');
        const titleDisplay = document.getElementById('titleDisplay');
        const mouth = document.getElementById('mouth');
        const playBtn = document.getElementById('playBtn');

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        if(surahName) titleDisplay.innerText = "Ø³ÙˆØ±Ø© " + surahName;

        // 3. Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªØ­Ù…ÙŠÙ„
        async function loadSurahData() {
            if(!surahId) return;

            // Ø£) ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙˆØª (Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ - Ø§Ù„Ù…Ø¹Ù„Ù… - ØªØ±Ø¯ÙŠØ¯ Ø£Ø·ÙØ§Ù„)
            // Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø£ØµÙØ§Ø± Ù„Ù„ÙŠØ³Ø§Ø± Ù„Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ­ØªØ§Ø¬ 078 ÙˆÙ„ÙŠØ³ 78
            const formattedId = surahId.toString().padStart(3, '0');
            // Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± ÙˆÙ…ÙˆØ«ÙˆÙ‚ Ø¬Ø¯Ø§Ù‹
            const audioUrl = `https://download.quranicaudio.com/quran/muhammad_siddiq_minshawi_(muallim)/${formattedId}.mp3`;
            
            audioPlayer.src = audioUrl;
            
            // Ø¨) Ø¬Ù„Ø¨ Ø§Ù„Ù†Øµ
            try {
                const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahId}`);
                const data = await response.json();
                
                let fullText = "";
                data.data.ayahs.forEach(ayah => {
                    // Ø¥Ø¶Ø§ÙØ© Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ù…Ø²Ø®Ø±Ù
                    fullText += `${ayah.text} <span class="ayah-symbol">ï´¿${ayah.numberInSurah}ï´¾</span> `;
                });
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±
                quranText.innerHTML = `<div class="fade-in-text" style="direction: rtl;">${fullText}</div>`;
            } catch (error) {
                quranText.innerText = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ§Øª.";
            }
        }

        // 4. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ…
        function playAudio() {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
            const playPromise = audioPlayer.play();
            
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    // Ù†Ø¬Ø­ Ø§Ù„ØªØ´ØºÙŠÙ„
                    mouth.classList.add('talking');
                    console.log("Audio playing");
                })
                .catch(error => {
                    // ÙØ´Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„ (Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ù†Ù‚Ø±Ø©)
                    console.error("Playback failed:", error);
                    // ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ù…ØªØµÙØ­ØŒ Ù†Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø©
                    // alert("Ø§Ø¶ØºØ· Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„ØªØ´ØºÙŠÙ„");
                });
            }
        }

        function pauseAudio() {
            audioPlayer.pause();
            mouth.classList.remove('talking');
        }

        function goBack() {
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª Ù‚Ø¨Ù„ Ø§Ù„Ø®Ø±ÙˆØ¬
            audioPlayer.pause();
            window.location.href = 'surah_list.html';
        }

        // 5. Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØµÙˆØª
        audioPlayer.onpause = () => mouth.classList.remove('talking');
        audioPlayer.onended = () => mouth.classList.remove('talking');
        // ÙÙŠ Ø­Ø§Ù„ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ
        audioPlayer.onerror = () => {
            alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„ØµÙˆØª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.");
        };

        // 6. Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        window.onload = () => {
            loadSurahData();
            playBtn.focus(); // ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¤Ø´Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù„Ø±ÙŠÙ…ÙˆØª
        };

        // Ø¯Ø¹Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±ÙŠÙ…ÙˆØª (Ø±Ø¬ÙˆØ¹)
        document.addEventListener('keydown', function(e) {
            if(e.key === 'Backspace' || e.key === 'Escape') {
                goBack();
            }
        });

    </script>
</body>
</html>
