<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المصحف المعلم - دينا</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        /* --- 1. إعدادات الصفحة والخلفية --- */
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            /* خلفية تركوازية متدرجة تشبه الصورة المرفقة */
            background: linear-gradient(180deg, #80cbc4 0%, #4db6ac 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            font-family: 'Cairo', sans-serif;
            overflow: hidden;
            direction: rtl;
        }

        /* --- 2. الأزرار العلوية --- */
        .top-bar {
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
        }

        .top-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 3px solid #fff;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            color: #fff;
            font-size: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            backdrop-filter: blur(5px);
        }

        .top-btn:hover, .top-btn:focus {
            transform: scale(1.15);
            background: #fdd835;
            box-shadow: 0 0 15px #fff;
            outline: none;
        }

        /* --- 3. اللوح الخشبي (حاوية النص) --- */
        .paper-board {
            margin-top: 15vh; /* مسافة نسبية من الأعلى */
            width: 90%;
            max-width: 600px;
            height: 45vh; /* ارتفاع متجاوب */
            background: #fff9c4; /* لون ورق كريمي */
            border-radius: 30px;
            /* إطار مزدوج ليعطي شكل الخشب */
            border: 8px solid #d7ccc8; 
            outline: 6px solid #8d6e63;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            z-index: 10; /* مستوى الطبقة */
        }

        /* لافتة اسم السورة */
        .title-wood-sign {
            position: absolute;
            top: -40px;
            background: linear-gradient(to bottom, #ffecb3, #ffe082);
            padding: 8px 60px;
            border-radius: 20px;
            border: 4px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: #5d4037;
            font-size: 26px;
            font-weight: 800;
            z-index: 20;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.5);
        }

        /* منطقة النص القرآني */
        .quran-text-area {
            width: 100%;
            height: 100%;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: 'Amiri', serif;
            font-size: 28px;
            color: #3e2723; /* بني غامق للقراءة */
            font-weight: bold;
            line-height: 2.2;
            overflow-y: auto;
            padding: 10px;
        }
        .quran-text-area::-webkit-scrollbar { display: none; }

        /* --- 4. أزرار التحكم (الذهبية) --- */
        .controls-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            margin-top: -35px; /* تداخل مع اللوحة */
            z-index: 30; /* فوق اللوحة وفوق الشخصية */
            position: relative;
        }

        .ctrl-btn {
            background: linear-gradient(180deg, #ffeb3b 0%, #fbc02d 100%);
            border: 4px solid #fff;
            border-radius: 50%;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.25);
            transition: transform 0.2s, filter 0.2s;
            text-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-play {
            width: 90px;
            height: 75px; /* شكل بيضاوي */
            border-radius: 40px;
            font-size: 35px;
        }
        
        .btn-nav {
            width: 60px;
            height: 60px;
            font-size: 24px;
        }

        .ctrl-btn:hover, .ctrl-btn:focus {
            transform: scale(1.15);
            filter: brightness(1.1);
            outline: none;
            box-shadow: 0 0 20px #ffeb3b;
        }

        /* --- 5. منطقة الشخصيات (دينا) --- */
        .characters-area {
            position: absolute;
            bottom: -20px; /* مخفية قليلاً للأسفل لتبدو طبيعية */
            left: 0;
            width: 100%;
            height: 40vh; /* تأخذ مساحة من الشاشة */
            display: flex;
            justify-content: center; /* توسيط الشخصية */
            align-items: flex-end;
            pointer-events: none; /* السماح بالضغط من خلالها */
            z-index: 5; /* خلف الأزرار لكن أمام الخلفية */
            overflow: hidden;
        }

        .img-char {
            height: 100%; /* تملأ المساحة المخصصة */
            max-height: 350px; /* أقصى ارتفاع */
            object-fit: contain;
            /* ظل ناعم للشخصية لتبدو واقفة */
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3));
            /* حركة دخول للشخصية */
            animation: slideUp 1s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* تنسيق أرقام الآيات */
        .ayah-num {
            color: #d84315;
            font-family: 'Cairo', sans-serif;
            font-size: 0.75em;
            margin: 0 5px;
            background: rgba(255,255,255,0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* رسالة التحميل */
        .loader { font-size: 18px; color: #795548; font-weight: bold; }

    </style>
</head>
<body>

    <div class="top-bar">
        <button class="top-btn" onclick="location.reload()" title="إعادة تحميل">↻</button>
        <a href="surah_list.html" class="top-btn" title="القائمة الرئيسية">➜</a>
    </div>

    <div class="paper-board">
        <div class="title-wood-sign" id="surahNameTitle">...</div>

        <div class="quran-text-area" id="quranText">
            <div class="loader">جاري تحضير السورة...</div>
        </div>
    </div>

    <div class="controls-container">
        <button class="ctrl-btn btn-nav" onclick="nextSurah()" id="btnNext">⏮</button>
        <button class="ctrl-btn btn-play" onclick="togglePlay()" id="btnPlay">▶</button>
        <button class="ctrl-btn btn-nav" onclick="prevSurah()" id="btnPrev">⏭</button>
    </div>

    <div class="characters-area">
        <img src="assets/images/girl.png" alt="دينا" class="img-char">
    </div>

    <audio id="audioPlayer" preload="auto"></audio>

    <script>
        // --- 1. المتغيرات والعناصر ---
        const urlParams = new URLSearchParams(window.location.search);
        let currentId = parseInt(urlParams.get('id')) || 1; 
        let currentName = urlParams.get('name') || "الفاتحة";

        const audioPlayer = document.getElementById('audioPlayer');
        const quranText = document.getElementById('quranText');
        const surahNameTitle = document.getElementById('surahNameTitle');
        const btnPlay = document.getElementById('btnPlay');

        let isPlaying = false;

        // --- 2. تحميل السورة ---
        async function loadSurah(id, name) {
            surahNameTitle.innerText = name; // عرض الاسم في اللافتة

            // رابط الصوت (المنشاوي - المعلم) - سيرفر مباشر وسريع
            const formattedId = id.toString().padStart(3, '0');
            const audioUrl = `https://server10.mp3quran.net/minsh_awi/${formattedId}.mp3`;
            
            audioPlayer.src = audioUrl;
            
            // جلب النص
            try {
                const response = await fetch(`https://api.alquran.cloud/v1/surah/${id}`);
                const data = await response.json();
                
                let fullText = "";
                data.data.ayahs.forEach(ayah => {
                    fullText += `${ayah.text} <span class="ayah-num">﴿${ayah.numberInSurah}﴾</span> `;
                });
                quranText.innerHTML = fullText;
                
            } catch (error) {
                quranText.innerText = "يرجى التحقق من الاتصال بالإنترنت";
            }
        }

        // --- 3. التحكم بالصوت ---
        function togglePlay() {
            if (audioPlayer.paused) {
                const playPromise = audioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        btnPlay.innerText = "⏸"; // أيقونة الإيقاف
                        isPlaying = true;
                    }).catch(error => console.error("Error playing:", error));
                }
            } else {
                audioPlayer.pause();
                btnPlay.innerText = "▶"; // أيقونة التشغيل
                isPlaying = false;
            }
        }

        // إعادة الزر لوضعه الطبيعي عند انتهاء الصوت
        audioPlayer.onended = () => {
            btnPlay.innerText = "▶";
            isPlaying = false;
        };

        // --- 4. التنقل بين السور ---
        // خريطة بسيطة لأسماء السور (جزء عم والفاتحة كمثال)
        // يمكنك إضافة باقي المصحف إذا أردت، هنا أضفت الأهم لجزء عم
        const surahNames = {
            1: "الفاتحة", 78: "النبأ", 79: "النازعات", 80: "عبس", 81: "التكوير",
            82: "الانفطار", 83: "المطففين", 84: "الانشقاق", 85: "البروج", 86: "الطارق",
            87: "الأعلى", 88: "الغاشية", 89: "الفجر", 90: "البلد", 91: "الشمس",
            92: "الليل", 93: "الضحى", 94: "الشرح", 95: "التين", 96: "العلق",
            97: "القدر", 98: "البينة", 99: "الزلزلة", 100: "العاديات", 101: "القارعة",
            102: "التكاثر", 103: "العصر", 104: "الهمزة", 105: "الفيل", 106: "قريش",
            107: "الماعون", 108: "الكوثر", 109: "الكافرون", 110: "النصر", 111: "المسد",
            112: "الإخلاص", 113: "الفلق", 114: "الناس"
        };

        function nextSurah() {
            let nextId = currentId + 1;
            if (nextId > 114) nextId = 1;
            updateSurah(nextId);
        }

        function prevSurah() {
            let prevId = currentId - 1;
            if (prevId < 1) prevId = 114;
            updateSurah(prevId);
        }

        function updateSurah(newId) {
            currentId = newId;
            let name = surahNames[newId] || `سورة ${newId}`;
            
            // تحديث الرابط في المتصفح
            const newUrl = `surah.html?id=${newId}&name=${encodeURIComponent(name)}`;
            window.history.pushState({path: newUrl}, '', newUrl);

            // إيقاف القديم وتشغيل الجديد
            audioPlayer.pause();
            btnPlay.innerText = "▶";
            loadSurah(currentId, name);
        }

        // --- 5. عند بدء التشغيل ---
        window.onload = () => {
            loadSurah(currentId, currentName);
            btnPlay.focus(); // تحديد الزر للريموت
        };

        // دعم الرجوع
        document.addEventListener('keydown', function(e) {
            if(e.key === 'Backspace' || e.key === 'Escape') {
                window.location.href = 'surah_list.html';
            }
        });

    </script>
</body>
</html>
