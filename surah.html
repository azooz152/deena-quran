<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙŠÙ†Ø§ - Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…Ø¹Ù„Ù…</title>
    <style>
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ù„Ø´Ø§Ø´Ø§Øª Ù‡ÙˆØ§ÙˆÙŠ */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Arial', sans-serif;
            /* Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ÙÙŠ Ù…Ø¬Ù„Ø¯ assets Ù…Ø¨Ø§Ø´Ø±Ø© */
            background: url('assets/bg-main.png') no-repeat center center fixed;
            background-size: cover;
            background-color: #1a1a1a;
        }

        .container {
            position: relative; width: 100vw; height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…ÙˆØ²ÙˆÙ† */
        .back-btn {
            position: absolute; top: 20px; left: 20px;
            padding: 10px 30px; background: #4db6ac;
            border: 3px solid white; border-radius: 50px;
            color: white; font-weight: bold; cursor: pointer; z-index: 100;
        }

        /* Ø¥Ø·Ø§Ø± Ø§Ù„Ø¢ÙŠØ© */
        .ayah-box {
            position: relative; margin-top: 30px;
            width: 80%; background: white;
            border: 6px solid #fbc02d; border-radius: 30px;
            padding: 20px; z-index: 10; text-align: center;
            box-shadow: 0 8px 0 #b8860b;
        }

        #ayahText { color: #263238; font-size: 2.5rem; font-weight: bold; }

        /* Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ§Ù„Ø´ÙØ§Ù‡ 100% */
        .character-zone {
            position: absolute; bottom: 0;
            width: 100%; height: 75vh;
            display: flex; justify-content: center; align-items: flex-end;
        }

        .dina-wrapper { position: relative; height: 100%; }
        #dinaImg { height: 100%; display: block; }

        /* Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: Ø²Ø­Ù Ù„Ù„ÙŠØ³Ø§Ø± ÙˆÙ†Ø²ÙˆÙ„ Ù„Ù„Ø£Ø³ÙÙ„ */
        #mouth {
            position: absolute;
            top: 51.5%;   /* Ù†Ø²ÙˆÙ„ Ù„Ù„Ø£Ø³ÙÙ„ */
            left: 41.2%;  /* Ø²Ø­Ù Ù„Ù„ÙŠØ³Ø§Ø± */
            transform: translate(-50%, -50%);
            width: 78px; 
            z-index: 5;
        }
    </style>
</head>
<body onclick="initDina()">

    <div class="container">
        <button class="back-btn" onclick="history.back()">ğŸ  Ø±Ø¬ÙˆØ¹</button>
        <div class="ayah-box"><div id="ayahText">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div></div>

        <div class="character-zone">
            <div class="dina-wrapper">
                <img src="assets/images/girl.png" id="dinaImg">
                <img src="assets/images/mouth_closed.png" id="mouth">
            </div>
        </div>
    </div>

    <audio id="audioPlayer" crossorigin="anonymous" loop></audio>

<script>
    const audio = document.getElementById('audioPlayer');
    const mouthImg = document.getElementById('mouth');
    const textDisp = document.getElementById('ayahText');

    const sNum = localStorage.getItem('surah_num') || "001";
    const sName = localStorage.getItem('surah_name') || "Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©";
    audio.src = `https://server8.mp3quran.net/muhammad_siddeeq_al-minshawi/almusshaf_almuallim/${sNum.padStart(3, '0')}.mp3`;

    let started = false;

    function initDina() {
        if (!started) {
            // Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù‡ÙˆØ§ÙˆÙŠ (Ø¨Ù†Øª)
            const speech = new SpeechSynthesisUtterance(`Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ ÙŠØ§ ØµØ¯ÙŠÙ‚ØªÙŠ Ø§Ù„Ù…Ø¨Ø¯Ø¹Ø©.. Ù‡ÙŠØ§ Ù„Ù†Ù‚Ø±Ø£ Ø³ÙˆØ±Ø© ${sName}`);
            speech.lang = 'ar-SA';
            speech.pitch = 1.6; // ØµÙˆØª Ø¨Ù†Øª Ø·ÙÙ„Ø©
            speech.rate = 0.9;

            window.speechSynthesis.speak(speech);
            speech.onend = () => {
                startSync();
                audio.play();
                textDisp.innerText = sName;
            };
            started = true;
        }
    }

    function startSync() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = ctx.createAnalyser();
        const src = ctx.createMediaElementSource(audio);
        src.connect(analyser);
        analyser.connect(ctx.destination);
        analyser.fftSize = 256;
        const data = new Uint8Array(analyser.frequencyBinCount);

        function animate() {
            if (!audio.paused) {
                analyser.getByteFrequencyData(data);
                let vol = data.reduce((a, b) => a + b) / data.length;
                if (vol > 35) mouthImg.src = 'assets/images/mouth_open.png';
                else if (vol > 15) mouthImg.src = 'assets/images/mouth_half.png';
                else mouthImg.src = 'assets/images/mouth_closed.png';
            }
            requestAnimationFrame(animate);
        }
        animate();
    }
</script>
</body>
</html>
