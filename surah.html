<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المصحف المعلم - دينا</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: #26a69a; /* لون الخلفية التركواز */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            font-family: 'Cairo', sans-serif;
            overflow: hidden;
            direction: rtl;
        }

        .top-bar {
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
        }

        .top-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid #fff;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: #fff;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
            backdrop-filter: blur(5px);
        }

        .paper-board {
            margin-top: 15vh;
            width: 90%;
            max-width: 600px;
            height: 45vh;
            background: #fff9c4;
            border-radius: 25px;
            border: 6px solid #e0e0e0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            z-index: 10;
        }

        .title-sign {
            background: #fdd835;
            color: #3e2723;
            padding: 8px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            position: absolute;
            top: -25px;
            border: 3px solid #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .quran-text-area {
            width: 100%;
            height: 100%;
            margin-top: 20px;
            text-align: center;
            font-family: 'Amiri', serif;
            font-size: 28px;
            color: #000;
            line-height: 2.2;
            overflow-y: auto;
            padding: 10px;
        }
        .quran-text-area::-webkit-scrollbar { display: none; }

        .ayah-num {
            color: #d32f2f;
            font-size: 0.8em;
            margin: 0 5px;
            background: rgba(255, 213, 79, 0.4);
            padding: 0 5px;
            border-radius: 50%;
        }

        .controls-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: -30px;
            z-index: 20;
            position: relative;
        }

        .ctrl-btn {
            background: #ffb74d;
            border: 4px solid #fff;
            border-radius: 50%;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }

        .ctrl-btn:active { transform: scale(0.95); }

        .btn-play {
            width: 90px;
            height: 90px;
            font-size: 40px;
            background: #ff9800;
        }
        
        .btn-nav {
            width: 60px;
            height: 60px;
            font-size: 24px;
        }

        /* زر تحميل إضافي لتطبيق فكرتك */
        .download-btn {
            width: 40px;
            height: 40px;
            background: #4db6ac;
            font-size: 20px;
            position: absolute;
            right: -60px; /* بجانب أزرار التحكم */
        }

        .character-img {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            max-width: 80%;
            z-index: 5;
            pointer-events: none;
        }
        
        /* رسالة حالة */
        #statusMsg {
            position: absolute;
            top: 70px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
        }

    </style>
</head>
<body>

    <div class="top-bar">
        <button class="top-btn" onclick="location.reload()" title="تحديث">↻</button>
        <a href="surah_list.html" class="top-btn" title="القائمة">➜</a>
    </div>

    <div id="statusMsg">جاري التحميل...</div>

    <div class="paper-board">
        <div class="title-sign" id="surahNameTitle">...</div>
        <div class="quran-text-area" id="quranText"></div>
    </div>

    <div class="controls-container">
        <button class="ctrl-btn btn-nav" onclick="prevSurah()">⏮</button>
        
        <button class="ctrl-btn btn-play" onclick="togglePlay()" id="btnPlay">▶</button>
        
        <button class="ctrl-btn btn-nav" onclick="nextSurah()">⏭</button>
    </div>

    <img src="assets/images/girl.png" alt="Character" class="character-img">

    <audio id="audioPlayer" preload="auto"></audio>

    <script>
        // --- 1. إعداد البيانات ---
        // أسماء السور
        const surahNames = {
            78: "النبأ", 79: "النازعات", 80: "عبس", 81: "التكوير", 82: "الانفطار", 83: "المطففين", 84: "الانشقاق", 85: "البروج", 86: "الطارق", 87: "الأعلى", 88: "الغاشية", 89: "الفجر", 90: "البلد", 91: "الشمس", 92: "الليل", 93: "الضحى", 94: "الشرح", 95: "التين", 96: "العلق", 97: "القدر", 98: "البينة", 99: "الزلزلة", 100: "العاديات", 101: "القارعة", 102: "التكاثر", 103: "العصر", 104: "الهمزة", 105: "الفيل", 106: "قريش", 107: "الماعون", 108: "الكوثر", 109: "الكافرون", 110: "النصر", 111: "المسد", 112: "الإخلاص", 113: "الفلق", 114: "الناس"
        };

        // نصوص القرآن (نسخة مختصرة ليعمل الكود، يجب عليك وضع النص الكامل الذي كان لديك هنا)
        const quranData = {
            78: `بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ\nعَمَّ يَتَسَآءَلُونَ (1) عَنِ ٱلنَّبَإِ ٱلۡعَظِيمِ (2)...`,
            88: `بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ\nهَلۡ أَتَىٰكَ حَدِيثُ ٱلۡغَٰشِيَةِ (1)...` 
            // ... (ضع باقي النصوص الكاملة هنا) ...
        };

        // --- 2. تهيئة العناصر ---
        const urlParams = new URLSearchParams(window.location.search);
        let currentId = parseInt(urlParams.get('id')) || 78;
        
        const audioPlayer = document.getElementById('audioPlayer');
        const quranText = document.getElementById('quranText');
        const surahNameTitle = document.getElementById('surahNameTitle');
        const btnPlay = document.getElementById('btnPlay');
        const statusMsg = document.getElementById('statusMsg');

        let isPlaying = false;

        // --- 3. الدوال المساعدة ---
        function formatText(text) {
            if (!text) return "جاري تحميل النص...";
            let formatted = text.replace('بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ', '<span class="basmala">بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ</span>');
            formatted = formatted.replace(/\((\d+)\)/g, '<span class="ayah-num">﴿$1﴾</span>');
            formatted = formatted.replace(/\n/g, '<br>');
            return formatted;
        }

        // --- 4. تحميل السورة وتشغيلها ---
        function loadSurah(id) {
            // أ) تحديث الواجهة
            const name = surahNames[id] || "سورة";
            surahNameTitle.innerText = "سورة " + name;
            
            // ب) تحديث النص
            if(quranData[id]) {
                quranText.innerHTML = formatText(quranData[id]);
            } else {
                quranText.innerHTML = formatText(`بِسۡمِ ٱللَّهِ ٱلرَّحۡمَٰنِ ٱلرَّحِيمِ\n(النص غير متوفر حالياً لسورة ${name})`);
            }

            // ج) رابط الصوت (السيرفر المضمون والذكي)
            // هذا السيرفر يقبل التشغيل المباشر ولا يحظر الروابط مثل السابق
            // يقوم بإضافة أصفار تلقائياً (مثلاً 88 يحولها 088)
            const formattedId = id.toString().padStart(3, '0');
            const audioUrl = `https://server10.mp3quran.net/minsh_awi/${formattedId}.mp3`;

            // إظهار رسالة جاري التحميل
            showStatus("جاري تجهيز الصوت...");
            
            audioPlayer.src = audioUrl;
            audioPlayer.load(); // أمر للمتصفح بالبدء في التحميل فوراً

            // تحديث الرابط في الأعلى
            const newUrl = `surah.html?id=${id}&name=${encodeURIComponent(name)}`;
            window.history.pushState({path: newUrl}, '', newUrl);
        }

        // --- 5. التحكم بالتشغيل ---
        function togglePlay() {
            if (audioPlayer.paused) {
                showStatus("جاري التشغيل...");
                const playPromise = audioPlayer.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        btnPlay.innerText = "⏸";
                        isPlaying = true;
                        hideStatus(); // إخفاء الرسالة عند النجاح
                    }).catch(error => {
                        console.error(error);
                        showStatus("خطأ: تأكد من الاتصال بالإنترنت");
                    });
                }
            } else {
                audioPlayer.pause();
                btnPlay.innerText = "▶";
                isPlaying = false;
            }
        }

        // --- 6. التنقل ---
        function nextSurah() {
            let next = currentId + 1;
            if (next > 114) next = 78;
            currentId = next;
            resetPlayer();
        }

        function prevSurah() {
            let prev = currentId - 1;
            if (prev < 78) prev = 114;
            currentId = prev;
            resetPlayer();
        }

        function resetPlayer() {
            audioPlayer.pause();
            btnPlay.innerText = "▶";
            loadSurah(currentId);
        }

        // أحداث الصوت
        audioPlayer.oncanplay = () => hideStatus(); // عندما يكون جاهزاً نخفي الرسالة
        audioPlayer.onwaiting = () => showStatus("جاري التحميل..."); // لو النت بطيء
        audioPlayer.onended = () => {
            btnPlay.innerText = "▶";
            isPlaying = false;
        };

        // دوال رسالة الحالة
        function showStatus(msg) {
            statusMsg.innerText = msg;
            statusMsg.style.display = 'block';
        }
        function hideStatus() {
            statusMsg.style.display = 'none';
        }

        // عند فتح الصفحة
        window.onload = () => {
            loadSurah(currentId);
        };

    </script>
</body>
</html>
